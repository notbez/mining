<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Майнинг</title>
        <link rel="stylesheet" href="/styles.css" />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
            rel="stylesheet"
        />

        <script src="https://telegram.org/js/telegram-web-app.js"></script>
    </head>
    <body>
        <header class="headOfMining">
            <div class="balik">
                <div class="chethik" id="chethik">0</div>
                <div class="poyasneniye">
                    When the boost is activated and active the balance will be
                    highlighted in yellow.
                </div>
            </div>
        </header>

        <section class="zavodsec">

            <div class="miandta">
                    <button class="miningk">
                        <img src="/icons/mininginac.png" alt="">
                    </button>

                    <button class="tasks">
                        <img src="/icons/taskinac.png" alt="">
                    </button>
            </div>
            <button class="zavod">
                <img id="zavodImg" src="/icons/static-mining.png" alt="Завод" />
            </button>
        </section>

        <hr class="header-line2" />

        <nav class="bottom-nav">
            <button
                data-page="profile"
                data-active="6.png"
                data-inactive="1.png"
                onclick="navigate('/')"
            >
                <img src="/icons/1.png" alt="Профиль" class="buttons" />
            </button>
            <button
                data-page="rating"
                data-active="7.png"
                data-inactive="2.png"
                onclick="navigate('/rating')"
            >
                <img src="/icons/2.png" alt="Рейтинг" class="buttons" />
            </button>
            <button
                data-page="mining"
                data-active="8.png"
                data-inactive="3.png"
                onclick="navigate('/mining')"
            >
                <img src="/icons/3.png" alt="Майнинг" class="buttons" />
            </button>
            <button
                data-page="friends"
                data-active="9.png"
                data-inactive="4.png"
                onclick="navigate('/friends')"
            >
                <img src="/icons/4.png" alt="Друзья" class="buttons" />
            </button>
        </nav>

        <script src="/script.js"></script>

        <script>
            document.addEventListener("DOMContentLoaded", async () => {
              const balanceDiv = document.getElementById("chethik");
              const telegramId = localStorage.getItem("telegramId");
            
              if (!telegramId) {
                console.warn("Нет telegramId в localStorage");
                balanceDiv.textContent = "0";
                return;
              }
            
              async function updateBalance() {
                try {
                  const res = await fetch(`/mining/coins/${telegramId}`);
                  const data = await res.json();
                  balanceDiv.textContent = data.coins ?? 0;
                } catch (err) {
                  console.error("Ошибка при получении баланса:", err);
                  balanceDiv.textContent = "⚠️";
                }
              }
            
              // Обновляем баланс сразу при загрузке
              await updateBalance();
            
              // Автообновление баланса каждые 30 секунд
              setInterval(updateBalance, 30000);
            });
            </script>
    </body>
</html>
